// ═══════════════════════════════════════════════════════════════════════════
// PATH LABELS - Mapping des chemins techniques vers des labels humains
// ═══════════════════════════════════════════════════════════════════════════

export const PATH_LABELS = {
  // ═══ THEME GLOBAL ═══
  "theme": "Thème",
  "theme.primaryColor": "Couleur principale",
  "theme.secondaryColor": "Couleur secondaire",
  "theme.fontHeading": "Police des titres",
  "theme.fontBody": "Police du texte",
  "theme.mode": "Mode (clair/sombre)",

  // ═══ HEADER ═══
  "header": "En-tête",
  "header.enabled": "En-tête visible",
  "header.logoText": "Nom du logo",
  "header.ctaButton": "Bouton d'action",
  "header.ctaButton.text": "Texte du bouton",
  "header.ctaButton.url": "Lien du bouton",
  "header.sticky": "En-tête fixe",
  "header.styles": "Style de l'en-tête",
  "header.styles.background": "Fond de l'en-tête",
  "header.styles.background.color": "Couleur de fond",
  "header.styles.ctaButton.bgColor": "Couleur du bouton",
  "header.styles.shadow": "Ombre de l'en-tête",

  // ═══ HERO ═══
  "hero": "Section héro",
  "hero.enabled": "Section héro visible",
  "hero.badge": "Badge accroche",
  "hero.title": "Titre principal",
  "hero.subtitle": "Sous-titre",
  "hero.ctaPrimary": "Bouton principal",
  "hero.ctaPrimary.text": "Texte du bouton principal",
  "hero.ctaPrimary.url": "Lien du bouton principal",
  "hero.ctaSecondary": "Bouton secondaire",
  "hero.ctaSecondary.text": "Texte du bouton secondaire",
  "hero.ctaSecondary.url": "Lien du bouton secondaire",
  "hero.image": "Image du héro",
  "hero.styles": "Style du héro",
  "hero.styles.background": "Fond du héro",
  "hero.styles.background.color": "Couleur de fond",
  "hero.styles.background.gradient": "Dégradé de fond",
  "hero.styles.title": "Style du titre",
  "hero.styles.title.color": "Couleur du titre",
  "hero.styles.subtitle": "Style du sous-titre",
  "hero.styles.subtitle.color": "Couleur du sous-titre",
  "hero.styles.badge": "Style du badge",
  "hero.styles.badge.bgColor": "Fond du badge",
  "hero.styles.badge.textColor": "Texte du badge",
  "hero.styles.primaryButton": "Style bouton principal",
  "hero.styles.primaryButton.bgColor": "Couleur bouton principal",
  "hero.styles.secondaryButton": "Style bouton secondaire",
  "hero.styles.secondaryButton.borderColor": "Bordure bouton secondaire",
  "hero.styles.buttonRadius": "Arrondi des boutons",
  "hero.styles.padding": "Espacement",
  "hero.styles.padding.vertical": "Espacement vertical",

  // ═══ SERVICES ═══
  "services": "Section services",
  "services.enabled": "Section services visible",
  "services.title": "Titre des services",
  "services.subtitle": "Sous-titre des services",
  "services.items": "Liste des services",
  "services.styles": "Style des services",
  "services.styles.background": "Fond de la section",
  "services.styles.background.color": "Couleur de fond",
  "services.styles.cardRadius": "Arrondi des cartes",
  "services.styles.cardBg": "Fond des cartes",
  "services.styles.columns": "Nombre de colonnes",

  // ═══ ABOUT ═══
  "about": "Section à propos",
  "about.enabled": "Section à propos visible",
  "about.title": "Titre à propos",
  "about.subtitle": "Sous-titre à propos",
  "about.content": "Texte de présentation",
  "about.image": "Image de présentation",
  "about.values": "Valeurs de l'entreprise",
  "about.styles": "Style de la section",
  "about.styles.background": "Fond de la section",
  "about.styles.background.color": "Couleur de fond",
  "about.styles.titleColor": "Couleur du titre",
  "about.styles.textAlign": "Alignement du texte",

  // ═══ TESTIMONIALS ═══
  "testimonials": "Section témoignages",
  "testimonials.enabled": "Témoignages visibles",
  "testimonials.title": "Titre des témoignages",
  "testimonials.subtitle": "Sous-titre des témoignages",
  "testimonials.items": "Liste des témoignages",
  "testimonials.styles": "Style des témoignages",
  "testimonials.styles.background": "Fond de la section",
  "testimonials.styles.background.color": "Couleur de fond",
  "testimonials.styles.cardBg": "Fond des cartes",
  "testimonials.styles.starColor": "Couleur des étoiles",

  // ═══ FAQ ═══
  "faq": "Section FAQ",
  "faq.enabled": "FAQ visible",
  "faq.title": "Titre de la FAQ",
  "faq.subtitle": "Sous-titre de la FAQ",
  "faq.items": "Liste des questions",
  "faq.styles": "Style de la FAQ",
  "faq.styles.background": "Fond de la section",
  "faq.styles.background.color": "Couleur de fond",
  "faq.styles.questionBg": "Fond des questions",

  // ═══ CTA ═══
  "cta": "Section appel à l'action",
  "cta.enabled": "Section CTA visible",
  "cta.title": "Titre du CTA",
  "cta.subtitle": "Sous-titre du CTA",
  "cta.buttonPrimary": "Bouton principal",
  "cta.buttonPrimary.text": "Texte du bouton",
  "cta.buttonPrimary.url": "Lien du bouton",
  "cta.styles": "Style du CTA",
  "cta.styles.background": "Fond de la section",
  "cta.styles.background.color": "Couleur de fond",

  // ═══ CONTACT ═══
  "contact": "Section contact",
  "contact.enabled": "Section contact visible",
  "contact.title": "Titre contact",
  "contact.subtitle": "Sous-titre contact",
  "contact.email": "Adresse email",
  "contact.phone": "Numéro de téléphone",
  "contact.address": "Adresse postale",
  "contact.hours": "Horaires d'ouverture",
  "contact.styles": "Style du contact",
  "contact.styles.background": "Fond de la section",
  "contact.styles.background.color": "Couleur de fond",

  // ═══ FOOTER ═══
  "footer": "Pied de page",
  "footer.enabled": "Pied de page visible",
  "footer.copyright": "Texte copyright",
  "footer.socials": "Réseaux sociaux",
  "footer.legalLinks": "Mentions légales",
  "footer.styles": "Style du pied de page",
  "footer.styles.background": "Fond du pied de page",
  "footer.styles.background.color": "Couleur de fond",
}

// ═══════════════════════════════════════════════════════════════════════════
// SECTION LABELS
// ═══════════════════════════════════════════════════════════════════════════

export const SECTION_LABELS = {
  header: "En-tête",
  hero: "Héro",
  services: "Services",
  about: "À propos",
  testimonials: "Témoignages",
  faq: "FAQ",
  cta: "Appel à l'action",
  contact: "Contact",
  footer: "Pied de page"
}

// ═══════════════════════════════════════════════════════════════════════════
// FIELD LABELS (pour les items)
// ═══════════════════════════════════════════════════════════════════════════

export const FIELD_LABELS = {
  // Communs
  title: "Titre",
  subtitle: "Sous-titre",
  description: "Description",
  content: "Contenu",
  name: "Nom",
  text: "Texte",
  url: "Lien",
  image: "Image",
  icon: "Icône",
  enabled: "Visible",
  
  // Services
  tagline: "Accroche",
  price: "Prix",
  
  // Testimonials
  quote: "Témoignage",
  author: "Auteur",
  role: "Fonction",
  company: "Entreprise",
  rating: "Note",
  avatar: "Photo",
  
  // FAQ
  question: "Question",
  answer: "Réponse",
  
  // Stats
  value: "Valeur",
  label: "Libellé",
  
  // Boutons
  ctaPrimary: "Bouton principal",
  ctaSecondary: "Bouton secondaire",
  ctaButton: "Bouton d'action",
  buttonPrimary: "Bouton principal",
  
  // Contact
  email: "Email",
  phone: "Téléphone",
  address: "Adresse",
  hours: "Horaires",
  
  // Header
  logoText: "Logo",
  badge: "Badge"
}

// ═══════════════════════════════════════════════════════════════════════════
// HUMANIZE PATH - Fonction principale
// ═══════════════════════════════════════════════════════════════════════════

export function humanizePath(path) {
  if (!path) return "Élément"
  
  // Cas direct : chemin exact dans le mapping
  if (PATH_LABELS[path]) {
    return PATH_LABELS[path]
  }
  
  // Cas avec index d'array : services.items[0].name
  const arrayMatch = path.match(/^(\w+)\.items\[(\d+)\]\.?(\w*)$/)
  if (arrayMatch) {
    const [, section, index, field] = arrayMatch
    const sectionLabel = SECTION_LABELS[section] || section
    const fieldLabel = field ? FIELD_LABELS[field] || field : ""
    const num = parseInt(index) + 1
    
    if (field) {
      return `${fieldLabel} du ${sectionLabel.toLowerCase()} n°${num}`
    }
    return `${sectionLabel} n°${num}`
  }
  
  // Cas avec values (about) : about.values[0].title
  const valuesMatch = path.match(/^(\w+)\.values\[(\d+)\]\.?(\w*)$/)
  if (valuesMatch) {
    const [, section, index, field] = valuesMatch
    const fieldLabel = field ? FIELD_LABELS[field] || field : ""
    const num = parseInt(index) + 1
    
    if (field) {
      return `${fieldLabel} de la valeur n°${num}`
    }
    return `Valeur n°${num}`
  }
  
  // Cas avec styles : hero.styles.title.color
  const stylesMatch = path.match(/^(\w+)\.styles\.(.+)$/)
  if (stylesMatch) {
    const [, section, stylePath] = stylesMatch
    const sectionLabel = SECTION_LABELS[section] || section
    
    // Essayer le chemin complet styles
    const fullStylePath = `${section}.styles.${stylePath}`
    if (PATH_LABELS[fullStylePath]) {
      return PATH_LABELS[fullStylePath]
    }
    
    // Sinon, construire un label
    const styleParts = stylePath.split('.')
    const lastPart = styleParts[styleParts.length - 1]
    
    const styleLabels = {
      color: "Couleur",
      bgColor: "Couleur de fond",
      textColor: "Couleur du texte",
      borderColor: "Couleur de bordure",
      gradient: "Dégradé",
      radius: "Arrondi",
      padding: "Espacement",
      shadow: "Ombre"
    }
    
    return `${styleLabels[lastPart] || lastPart} (${sectionLabel.toLowerCase()})`
  }
  
  // Cas simple : section.field
  const simpleMatch = path.match(/^(\w+)\.(\w+)$/)
  if (simpleMatch) {
    const [, section, field] = simpleMatch
    const sectionLabel = SECTION_LABELS[section] || section
    const fieldLabel = FIELD_LABELS[field] || field
    return `${fieldLabel} (${sectionLabel.toLowerCase()})`
  }
  
  // Cas boutons : hero.ctaPrimary.text
  const buttonMatch = path.match(/^(\w+)\.(cta\w+|button\w+)\.(\w+)$/)
  if (buttonMatch) {
    const [, section, button, field] = buttonMatch
    const sectionLabel = SECTION_LABELS[section] || section
    const buttonLabel = FIELD_LABELS[button] || button
    const fieldLabel = FIELD_LABELS[field] || field
    return `${fieldLabel} du ${buttonLabel.toLowerCase()} (${sectionLabel.toLowerCase()})`
  }
  
  // Fallback : retourner le dernier segment
  const parts = path.split('.')
  const lastPart = parts[parts.length - 1]
  return FIELD_LABELS[lastPart] || lastPart
}

// ═══════════════════════════════════════════════════════════════════════════
// HUMANIZE ACTION - Pour les messages d'action
// ═══════════════════════════════════════════════════════════════════════════

export function humanizeAction(action) {
  const { type, path, section, label } = action
  
  // Si un label est fourni, l'utiliser
  if (label) return label
  
  const humanPath = path ? humanizePath(path) : (section ? SECTION_LABELS[section] : "Élément")
  
  switch (type) {
    case 'update':
      return `${humanPath} modifié`
    case 'update_item':
      return `${humanPath} modifié`
    case 'add_item':
      return `${humanPath} ajouté`
    case 'delete_item':
      return `${humanPath} supprimé`
    case 'generate_section':
      return `${SECTION_LABELS[section] || section} généré`
    case 'apply_preset':
      return `Thème appliqué`
    case 'update_theme':
      return `Thème modifié`
    case 'toggle_section':
      return `${SECTION_LABELS[section] || section} ${action.enabled ? 'activé' : 'masqué'}`
    default:
      return humanPath
  }
}

// ═══════════════════════════════════════════════════════════════════════════
// GET ELEMENT DESCRIPTION - Pour décrire un élément sélectionné
// ═══════════════════════════════════════════════════════════════════════════

export function getElementDescription(selectedElement) {
  if (!selectedElement) return null
  
  const { section, field, itemIndex, currentValue } = selectedElement
  
  let description = ""
  
  if (itemIndex !== null && itemIndex !== undefined) {
    // Item dans un array
    const sectionLabel = SECTION_LABELS[section] || section
    const fieldLabel = FIELD_LABELS[field] || field
    description = `${fieldLabel} du ${sectionLabel.toLowerCase()} n°${itemIndex + 1}`
  } else {
    // Champ simple
    const path = `${section}.${field}`
    description = humanizePath(path)
  }
  
  return {
    label: description,
    preview: currentValue ? `"${String(currentValue).slice(0, 50)}${String(currentValue).length > 50 ? '...' : ''}"` : "(vide)"
  }
}
